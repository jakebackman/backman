var blogTemplates={};blogTemplates.blogPostSummary_0=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='<div class="text-container"><div class="size_0 time clr_contTypeB_subTxt">'+((__t=(formattedDatetime))==null?"":__t)+'</div><div class="size_title_3 title clr_contTypeB_hdlTxt">'+((__t=(formattedTitle))==null?"":__t)+'</div><div class="size_1 max_3_lines description clr_contTypeB_txt">'+((__t=(formattedShortDesc))==null?"":__t)+"</div></div>";if(imageUrl){__p+='<div class="image sliced_image" style="background-image:url(\''+((__t=(imageUrl))==null?"":__t)+"')\"></div>"}__p+=""}return __p};blogTemplates.blogPostSummary_4=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+="";if(imageUrl){__p+='<div class="image-container clr_images_image1_brdr clr_images_image1_bg"><div class="image sliced_image" style="background-image:url(\''+((__t=(imageUrl))==null?"":__t)+"')\"></div></div>"}__p+='<div class="size_0 time clr_contTypeB_subTxt">'+((__t=(formattedDatetime))==null?"":__t)+'</div><div class="size_title_3 title clr_contTypeB_hdlTxt">'+((__t=(formattedTitle))==null?"":__t)+"</div>";if(formattedShortDesc){__p+='<div class="size_1 max_3_lines description clr_contTypeB_txt">'+((__t=(formattedShortDesc))==null?"":__t)+"</div>"}__p+=""}return __p};blogTemplates.blogPostSummary_2=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='<div class="image sliced_image" style="background-image:url(\''+((__t=(imageUrl))==null?"":__t)+'\');"></div><div class="text-place-holder"><div class="text-container clr_contTypeC_bg"><div class="size_0 time clr_contTypeC_subTxt">'+((__t=(formattedDatetime))==null?"":__t)+'</div><div class="size_title_3 title clr_contTypeC_hdlTxt">'+((__t=(formattedTitle))==null?"":__t)+'</div></div></div><div class="size_1 max_3_lines description clr_contTypeB_txt">'+((__t=(formattedShortDesc))==null?"":__t)+"</div>"}return __p};blogTemplates.blogPostSummary_5=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='<div class="image sliced_image" style="background-image:url(\''+((__t=(imageUrl))==null?"":__t)+'\');"><div class="text-container clr_contTypeC_bg"><div class="size_0 time clr_contTypeC_subTxt">'+((__t=(formattedDatetime))==null?"":__t)+'</div><div class="size_title_3 title clr_contTypeC_hdlTxt">'+((__t=(formattedTitle))==null?"":__t)+"</div></div></div>"}return __p};blogTemplates.blogPostSummary_6=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='<div class="size_0 time clr_contTypeB_subTxt">'+((__t=(formattedDatetime))==null?"":__t)+'</div><div class="size_title_3 title clr_contTypeB_hdlTxt">'+((__t=(formattedTitle))==null?"":__t)+"</div>"}return __p};blogTemplates.blogPostSummary_3=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='<div class="size_0 time clr_contTypeB_subTxt">'+((__t=(formattedDatetime))==null?"":__t)+'</div><div class="size_title_3 title clr_contTypeB_hdlTxt">'+((__t=(formattedTitle))==null?"":__t)+"</div>";if(imageUrl){__p+='<div class="image sliced_image" style="background-image:url(\''+((__t=(imageUrl))==null?"":__t)+"');\" />"}__p+='<div class="size_1 max_3_lines description clr_contTypeB_txt">'+((__t=(formattedShortDesc))==null?"":__t)+"</div>"}return __p};blogTemplates.blogPost=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='<div class="scroll_wrapper"><div class="scroller t3d"><div class="header box_padding clr_contTypeB_headerItem_bg clr_contTypeB_headerItem_brdr"><div class="size_title_3 title clr_contTypeB_hdlTxt">'+((__t=(title))==null?"":__t)+"</div>";if(typeof(author)!="undefined"){__p+='<div class="author clr_contTypeB_subTxt">'+((__t=(author))==null?"":__t)+"</div>"}__p+='<div class="size_0 time clr_contTypeB_subTxt">'+((__t=(formattedDatetime))==null?"":__t)+'</div><div class="control_buttons_container"></div></div><div class="size_1 description_full box_padding clr_contTypeA_bg"></div></div></div>'}return __p};blogTemplates.postsList=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='<div class="scroll_wrapper"><div class="scroller"></div></div>'}return __p};blogTemplates.viewOriginalSiteButton=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='<div class="view_original_container"><div class="view_original_button clr_appGeneral_floatBtn_bg clr_appGeneral_floatBtn_brdr clr_appGeneral_floatBtn_hdlTxt clr_appGeneral_floatBtn_icn" data-role="button">'+((__t=(viewOriginalSite))==null?"":__t)+"</div></div>"}return __p}; var BlogPostModel=ItemModel.extend({initialize:function(){var b=this.get("contentWithHtml");if(!b){b=this.get("descriptionWithHtml")}var c=this.get("id")||"";c=c.split("/").pop();var a=Utils.Html.fixAlias(this.get("alias")||c);this.set({shareInfo:this.getShareInfo(),fullHtmlContent:b,alias:a,id:Utils.Helpers.generateGUID()})},getShareInfo:function(){var a=this.get("socialInfo");a.emailTitle=_T("SRssShareEmailSubject",{title:this.get("blogTitle")});a.emailDesc=a.title+"\n\n"+a.shortDesc;return a}}); var BlogPostsModel=ItemsModel.extend({createItemsCollection:function(){return new BlogPostsCollection(null,{extraInfo:this.get("params"),feedUrl:this.get("url"),take:this.get("take")})}}); var BlogPostsCollection=ItemsCollection.extend({model:BlogPostModel,POSTS_TAKE_COUNT:25,initialize:function(b,a){ItemsCollection.prototype.initialize.apply(this);if(!a.feedUrl){this.invalid=true}this.params={feedUrl:a.feedUrl,extraInfo:a.extraInfo,take:a.take||this.POSTS_TAKE_COUNT}},getServiceName:function(){return"CMS_FEEDS_GET"},parse:function(a){if(a&&a.link){this.trigger("viewOriginalSite",a.link)}if(this.skip==0&&a.items&&a.items.length>0){a.items[0].isFirst=true}_.each(a.items,function(b){b.blogTitle=a.title});return{models:a.items}},getParams:function(){this.params.skip=this.skip;return this.params}}); var BlogTemplateView=TemplateView.extend({_renderTab:function(c,d){var e=this.model.get("meta");var b=new BlogPostsModel(e.items[c]);if(e.pageLayout==1||!e.pageLayout||e.pageLayout<0||e.pageLayout>6){e.pageLayout=0}b.set({layoutId:e.pageLayout,layoutParams:e.layoutParams});var a=new BlogPostsView({model:b,showMoreStr:_T("HtmlTextBlogShowMorePosts"),loadingStr:_T("HtmlTextBlogLoadingPosts")});this.renderListPage({navRequest:d,model:b,view:a,errorMessage:"{$ToastMessageBlogFailedGetPosts}",dividedScreenOptions:{}})},getDetailsView:function(a){var b=new BlogPostView({model:a});b.bind("onShowOnMapTap",this._onShowOnMapTap,this);return b},_onShowOnMapTap:function(b){var c=b.get("geo");if(c.lat&&c["long"]){var a={location:{lat:c.lat,lng:c["long"]},header:b.get("formattedTitle"),address:""};var b=new Backbone.Model({markers:[a]});MapManager.show_on_map(this.$el,b)}}}); var BlogPostSummaryView=ListItemView.extend({className:"clr_contTypeB_bubbleItem_bg clr_contTypeB_bubbleItem_brdr t3d feed_bubble_item",events:{tap:"itemClicked"},render:function(){this.$el.attr("data-role","button");this.model.set({formattedDatetime:Utils.TimeDate.timeAsText(this.model.get("datetime")),formattedShortDesc:Utils.String.sanitizeText($.trim(this.model.get("description"))),formattedTitle:$.trim(this.model.get("socialInfo").title)});var a=blogTemplates["blogPostSummary_"+this.options.layoutType];if(this.options.layoutType==0&&this.model.get("isFirst")){a=blogTemplates.blogPostSummary_2;this.$el.addClass("layout-2")}else{this.$el.addClass("layout-"+this.options.layoutType)}if(this.options.layoutParams){if(this.options.layoutParams.useFlat){this.$el.removeClass("feed_bubble_item")}}this.$el.append(a(this.model.toJSON()));if(this.model.get("imageUrl")){this.$el.addClass("with-image")}else{this.$el.addClass("no-image")}return this},itemClicked:function(a){a.preventDefault();UN.navTo(this.model.get("alias"),{level:2,isInner:(LAYOUT===layoutFormat.narrow)})}}); var BlogPostView=Backbone.View.extend({className:"blog-post",initialize:function(){this.$el.attr({"data-role":"page"})},render:function(){var c=this.model.toJSON();if(c.author){c.author=_T("HtmlTextBlogbyAuthor",{author:c.author})}this.$el.append(blogTemplates.blogPost(c));if(window.Scrolling){Scrolling.init(this.$el.find(".scroll_wrapper"))}var a=this.$el.find(".description_full");var b=new HtmlContainerControl();var d=this.model.get("fullHtmlContent");b.renderHtml(a,d,{changeColors:true});if(this.model.get("link")){a.append(templates.viewOriginalTemplate({text:_T("HtmlTextBlogViewOriginalPost")}))}this.$el.find(".view-orig-container").tap(this._onViewOrigTap.hitch(this));this.addButtons(c);return this},addButtons:function(a){var c=this.$el.find(".control_buttons_container");if(a.geo){var b=new FlatButtonView({text:_T("HtmlTextShowOnMapButtonStr"),icon:"show-on-map"});b.bind("onButtonClicked",this._onShowOnMapTap,this);c.append(b.render().el)}ShareControlHelper.addShareControlButton(c,this.model)},_onShowOnMapTap:function(){this.trigger("onShowOnMapTap",this.model)},_onViewOrigTap:function(a){a.preventDefault();appDriver.openLink(null,null,{url:this.model.get("link")})},appendToView:function(a){this.$el.find(".scroller").append(a)}}); var BlogPostsView=ItemsView.extend({initialize:function(){this.$el.attr({"data-role":"page","data-buttons":"refresh"});this.$el.html(blogTemplates.postsList());Scrolling.init(this.$el.find(".scroll_wrapper"));this.$scroller=this.$el.find(".scroller");this.$el.bind("refresh",this.handleRefreshClick.hitch(this));this.$el.bind("silentRefresh",this.handleSilentRefresh.hitch(this));var a=this.model.get("items");if(a){a.bind("viewOriginalSite",this._onViewOriginalSite,this)}ItemsView.prototype.initialize.apply(this)},_onViewOriginalSite:function(a){if(this.model.get("showViewOriginalSite")){if(!this.$viewOriginalSite){this.$viewOriginalSite=$(blogTemplates.viewOriginalSiteButton({viewOriginalSite:_T("HtmlTextBlogViewOriginalSite")}));this.getRootView().append(this.$viewOriginalSite);this.$viewOriginalSite.tap(this._onViewOriginalTap.hitch(this))}this.viewOriginalLink=a}},_onViewOriginalTap:function(){if(this.viewOriginalLink){appDriver.openLink(null,null,{url:this.viewOriginalLink,title:this.viewOriginalLink})}},getRootView:function(){return this.$scroller},createItemView:function(a){return new BlogPostSummaryView({model:a,layoutType:this.model.get("layoutId"),layoutParams:this.model.get("layoutParams"),id:"blog_post_view_"+Utils.Helpers.generateGUID()})},addTabsView:function(a){this.getRootView().prepend(a)}}); 