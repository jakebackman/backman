var twitterTemplates={tweet_li:function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='<div class="tweet-image"><img src="'+((__t=(userJSON.imageUrl))==null?"":__t)+'" alt="'+((__t=(userJSON.displayName))==null?"":__t)+'" class="user-profile-link" /></div><div class="tweet-content"><div class="tweet-header"><div class="size_title_1 tweet-screen-name tweet-header-name clr_contTypeA_hdlTxt">'+((__t=(userJSON.userName))==null?"":__t)+'</div><div class="size_title_0 tweet-full-name clr_contTypeA_subTxt">'+((__t=(userJSON.displayName))==null?"":__t)+"</div><br/>";if(formattedRetweeterName){__p+='<div class="retweet-image mask_sprite clr_contTypeA_subIcn sprite-retweet"></div><div class="size_title_0 retweeter-name clr_contTypeA_subTxt">'+((__t=(formattedRetweeterName))==null?"":__t)+"</div>"}__p+='</div><div class="size_1 tweet-text clr_contTypeA_txt">'+((__t=(formattedDescription))==null?"":__t)+'</div><div class="size_0 tweet-time clr_contTypeA_subTxt">'+((__t=(formattedDatetime))==null?"":__t)+'</div><div class="time-tweet-image mask_sprite clr_contTypeA_subIcn sprite-tweet"></div></div>'}return __p},tweetDescriptionOnly:function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='<div class="tweet detailed-tweet t3d"><div class="tweet-content"><div class="size_1 tweet-text clr_contTypeA_txt">'+((__t=(formattedDescription))==null?"":__t)+'</div><div class="time-tweet-image mask_sprite clr_contTypeB_subIcn sprite-tweet"></div><div class="size_0 tweet-time clr_contTypeA_subTxt">'+((__t=(formattedDatetime))==null?"":__t)+"</div><br/>";if(typeof(retweeterName)!="undefined"){__p+='</br><div class="retweet-image mask_sprite clr_contTypeB_subIcn sprite-retweet"></div><div class="size_0 retweeter-text clr_contTypeA_subTxt">'+((__t=(retweetText))==null?"":__t)+'</div><div class="size_0 retweeter-name clr_contTypeA_lnkTxt" >'+((__t=(retweeterName))==null?"":__t)+"</a>"}__p+='</div><div class="control_buttons_container"></div></div>'}return __p},userHeader:function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='<div class="tweet-user t3d user_header_bcolor"><div class="tweet-user-image"><img src="'+((__t=(imageUrl))==null?"":__t)+'" alt="'+((__t=(displayName))==null?"":__t)+'" class="user-profile-link" /></div><div class="tweet-user-details"><h1 class="size_title_3 clr_contTypeB_hdlTxt">'+((__t=(displayName))==null?"":__t)+'</h1><div class="size_title_0 screen-name clr_contTypeB_subTxt"><span dir="ltr">@'+((__t=(userName))==null?"":__t)+'</span></div><div class="ff clearfix">';if(typeof(totalStatusesStr)!="undefined"){__p+='<div class="tweets"><div class="size_title_2 count clr_contTypeB_hdlTxt">'+((__t=(totalStatusesStr))==null?"":__t)+'</div><span class="size_title_0 clr_contTypeB_subTxt stats">'+((__t=(tweetsStaticText))==null?"":__t)+"</span></div>"}__p+="";if(typeof(totalFollowersStr)!="undefined"){__p+='<div class="followers"><div class="size_title_2 count clr_contTypeB_hdlTxt">'+((__t=(totalFollowersStr))==null?"":__t)+'</div><span class="size_title_0 clr_contTypeB_subTxt stats">'+((__t=(fallowersStaticText))==null?"":__t)+"</span></div>"}__p+='</div></div><a class="tweet-follow-button clr_contTypeB_btn_bg clr_contTypeB_btn_brdr clr_contTypeB_btn_hdlTxt" data-role="button" >'+((__t=(fallowStaticText))==null?"":__t)+"</a></div>"}return __p},queryHeader:function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='<div class="tweet-search t3d clr_contTypeB_bg clr_contTypeB_brdr""><h1 class="size_title_3 clr_contTypeB_hdlTxt">#'+((__t=(query))==null?"":__t)+"</h1></div>"}return __p}}; var TwitterTemplateHelper={createUserModel:function(b){var a=new TwitterUserModel({userName:b.userName,displayName:b.displayName,screenName:b.screenName,imageUrl:b.imageUrl,totalFollowers:b.totalFollowers,totalStatuses:b.totalStatuses,totalFollowersStr:localization.formatNumber(b.totalFollowers),totalStatusesStr:localization.formatNumber(b.totalStatuses),fallowersStaticText:_T("HtmlTextTwitterFollowers"),tweetsStaticText:_T("HtmlTextTwitterTweets"),fallowStaticText:_T("HtmlTextTwitterFollowButton")});return a},TWEET_LIST_TYPE_USER:0,TWEET_LIST_TYPE_LIST:1,TWEET_LIST_TYPE_QUERY:2}; var TwitterModel=ItemsModel.extend({initialize:function(){var a=this.get("params");if(!a){return}ItemsModel.prototype.initialize.apply(this,arguments);this.set({type:a.type});this.get("items").bind("getItemsSuccess",this._onGetItemsSuccess,this)},createItemsCollection:function(){var a=this.get("params");var b=parseInt(a.type);switch(b){case TwitterTemplateHelper.TWEET_LIST_TYPE_USER:return new UserTweetsCollection(null,a);case TwitterTemplateHelper.TWEET_LIST_TYPE_LIST:return new QueryTweetsCollection(null,a);case TwitterTemplateHelper.TWEET_LIST_TYPE_QUERY:return new QueryTweetsCollection(null,a);default:return new QueryTweetsCollection(null,a)}},_onGetItemsSuccess:function(a){if(a){if(a.user){this.set({user:a.user})}else{if(a.query){this.set({query:a.query})}}}}}); var TweetModel=ItemModel.extend({initialize:function(){var b=Utils.Html.fixAlias(this.get("alias")||(""+this.get("id")));var d="";var g=this.get("retweeter");if(g&&g.name){d=_T("HtmlTextTwitterRetweet",{retweeterName:g.name})}var c="";var e=this.get("description");if(e){c=this._updateTextWithStyledLinks(e)}var f=this.get("time");var a="";if(f){a=Utils.TimeDate.timeAsText(f)}this.set({alias:b,formattedRetweeterName:d,retweetText:_T("HtmlTextTwitterRetweetDetails"),formattedDescription:c,formattedDatetime:a,showOnMapButtonStr:_T("HtmlTextShowOnMapButtonStr"),shareInfo:this.getShareInfo()})},_rgxTweetUserName:new RegExp("\\[twit=(.*?)](.*?)\\[/twit]","g"),_rgxTweetLink:new RegExp("\\[url\\](.*?)\\[/url\\]","g"),_rgxTweetTrend:new RegExp("\\[trend=(.*?)](.*?)\\[/trend]","g"),select:function(){this.trigger("tweetSelected",this)},_updateTextWithStyledLinks:function(e,d){if(!d){d=""}var a=this.get("layoutId");if(a==1){var c="clr_contTypeB_lnkTxt"}else{var c="clr_contTypeA_lnkTxt"}var b='<a data-href="$2" class="'+c+'" urlSrc="http://twitter.com/$1" class="LinkURL slide"'+d+">$2</a>";e=e.replace(this._rgxTweetUserName,b);b='<a data-href="$1" class="'+c+'" urlSrc="$1" class="LinkURL slide"'+d+">$1</a>";e=e.replace(this._rgxTweetLink,b);b='<a data-href="#$1" class="'+c+'" urlSrc="http://mobile.twitter.com/searches?q=%23$1" class="LinkURL slide"'+d+">#$1</a>";e=e.replace(this._rgxTweetTrend,b);return e},getShareInfo:function(){var a=this.get("user");var d=this.get("socialInfo")||{};var c=a.get("userName")||a.get("displayName");if(c){var b=c.indexOf("@twitter.com");if(b>0){c=c.substring(0,b)}}if(!d.url||d.url===""){d.url="http://twitter.com/"+c}d.title=_T("STwitterShareEmailSubject",{name:c});if(d.shortDesc){d.twitterTitle=d.shortDesc}d.twitterFrom="@"+c;return d}}); var TwitterUserModel=Backbone.Model.extend({}); var UserTweetsCollection=ItemsCollection.extend({model:TweetModel,TWEETS_TAKE_COUNT:20,initialize:function(b,a){ItemsCollection.prototype.initialize.apply(this);if(a&&a.userName){this.params={type:a.type,userName:a.userName,extraInfo:a.params||{},take:this.TWEETS_TAKE_COUNT,layoutId:a.layoutId}}else{this.invalid=true}},parse:function(a){var d={};if(a&&a.statuses){var f=[];for(var b=0;b<a.statuses.length;b++){var e=a.statuses[b];e.user=TwitterTemplateHelper.createUserModel({userName:e.screenName||this.params.userName,displayName:e.user||a.user,screenName:e.sscreenName,imageUrl:e.icon||a.icon,totalFollowers:e.totalFollowers||a.totalFollowers,totalStatuses:e.totalStatuses||a.totalStatuses});f[b]=new TweetModel(e)}d.models=f;var c=TwitterTemplateHelper.createUserModel({userName:this.params.userName,displayName:a.user,screenName:this.params.screenName||this.params.userName,imageUrl:a.icon,totalFollowers:a.totalFollowers,totalStatuses:a.totalStatuses});d.metaData={user:c}}return d},getServiceName:function(){return"CMS_TWITTER_USER_GET"},getParams:function(){return this.params},isEOF:function(a,b){if(typeof(a.hasMoreItems)!=="undefined"){return !a.hasMoreItems}else{return ItemsCollection.prototype.isEOF.apply(this,[a,b])}}}); var QueryTweetsCollection=ItemsCollection.extend({model:TweetModel,TWEETS_TAKE_COUNT:20,initialize:function(b,a){ItemsCollection.prototype.initialize.apply(this);if(a&&a.userName){this.params={type:a.type,query:a.userName,extraInfo:a.params||{},take:this.TWEETS_TAKE_COUNT,layoutId:a.layoutId}}else{this.invalid=true}},parse:function(a){var f={};if(a&&a.results){var h=[];for(var e=0;e<a.results.length;e++){var g=a.results[e];var d=function(k){var m=null;var i=k;if(k.indexOf("@")>0){var j=k.split(" ");m=j.shift().split("@")[0];var l=j.join(" ");i=l.substring(1,l.length-1)}var n={userName:m,displayName:i};return n};var c=d(g.user);g.user=TwitterTemplateHelper.createUserModel({userName:c.userName||g.screenName,displayName:c.displayName,screenName:g.screenName,imageUrl:g.icon});var b=new TweetModel(g);h[e]=b}f.models=h;f.metaData={query:this.params.query}}return f},getServiceName:function(){return"CMS_TWITTER_QUERY_GET"},getParams:function(){this.params.skip=this.skip;return this.params},isEOF:function(a,b){if(typeof(a.hasMoreItems)!=="undefined"){return !a.hasMoreItems}else{return ItemsCollection.prototype.isEOF.apply(this,[a,b])}}}); var TwitterTemplateView=TemplateView.extend({QUERY_URL:"#",USER_URL:"@",DEFAULT_URL:"default",_renderTab:function(a,b){var c=this.model.get("meta");var e=c.items[a]||{};e.layoutId=c.pageLayout;var d={tabParams:e};UN.registerChange(this.onListSelected.hitch(this),2,{navRequest:b,data:d,cbSelectDefault:this._selectDefaultList.hitch(this)})},_selectDefaultList:function(b){var a=b.navRequest;UN.navTo(this.DEFAULT_URL,{navRequest:a,isInner:false})},onListSelected:function(g,c){var d=g.navRequest;var h=$.extend({},g.tabParams);if(c.startsWith(this.QUERY_URL)){var f=c.replace(this.QUERY_URL,"");$.extend(h,{userName:f,type:TwitterTemplateHelper.TWEET_LIST_TYPE_QUERY})}else{if(c.startsWith(this.USER_URL)){var f=c.replace(this.USER_URL,"");$.extend(h,{userName:f,type:TwitterTemplateHelper.TWEET_LIST_TYPE_USER})}else{}}var b=new TwitterModel({params:h});var a=new TweetsView({model:b});a.bind("onLinkPressed",this._onLinkPressed,this);var e=(c===this.DEFAULT_URL);this.renderListPage({navRequest:d,model:b,view:a,addTabs:e,level:2,dividedScreenOptions:{}})},getDetailsView:function(a){var b=new DetailedTweetPageView({model:a});b.bind("onLinkPressed",this._onLinkPressed,this);return b},_onLinkPressed:function(a){if(a.startsWith("http")){appDriver.openLink(null,null,{url:a,title:a,isModal:false});return}UsageManager.addEvent(analytics.usageEventTypeEnum.ItemView,{link:a,list:true});UN.navTo(a,{level:2})}}); var DetailedTweetPageView=Backbone.View.extend({events:{"tap a":"onLinkPressed"},initialize:function(){this.$el.attr({"data-role":"page"});this.homePageId="home_"+Utils.Helpers.generateGUID();this.detailsPageId="details_"+Utils.Helpers.generateGUID()},render:function(){var a=document.createElement("div");a.className="scroll_wrapper";this.scrollerElement=document.createElement("div");this.scrollerElement.className="scroller";a.appendChild(this.scrollerElement);this.el.appendChild(a);var b=$(a);Scrolling.init(b);this.renderHeader();this.renderTweet();this.renderDetails();return this},renderHeader:function(){var b=this.model.get("user");if(b){var a=new UserHeaderView({model:b,layoutId:this.model.get("layoutId")});this.scrollerElement.appendChild(a.render().el)}return this},renderTweet:function(){var b=this.model;if(b){var a=new DetailedTweetView({model:b,layoutId:this.model.get("layoutId")});a.bind("onRetweeterTap",this.retweeterTap,this);this.scrollerElement.appendChild(a.render().el)}},renderDetails:function(){},onLinkPressed:function(a){a.preventDefault();this.trigger("onLinkPressed",a.target.innerHTML)},retweeterTap:function(){var a="@"+this.model.get("retweeter").name;this.trigger("onLinkPressed",a)}}); var DetailedTweetView=Backbone.View.extend({className:"detailed-tweet clr_contTypeA_bg",render:function(){var a=this.model.toJSON();var b=this.model.get("retweeter");if(b&&b.name){a.retweeterName=b.name}this.$el.append(twitterTemplates.tweetDescriptionOnly(a));this.$el.find(".retweeter-name").tap(this.retweeterTap.hitch(this));ShareControlHelper.addShareControlButton(this.$el.find(".control_buttons_container"),this.model);return this},retweeterTap:function(a){a.preventDefault();this.trigger("onRetweeterTap")}}); var SearchHeaderView=Backbone.View.extend({render:function(){this.$el.append(twitterTemplates.queryHeader(this.model.toJSON()));return this}}); var TweetListView=ItemsView.extend({createItemView:function(b){var a=new TweetView({model:b,layoutId:this.options.layoutId});a.bind("onLinkPressed",this.onLinkPressed,this);return a},onLinkPressed:function(a){this.trigger("onLinkPressed",a)},getRootView:function(){return this.$el}}); var TweetView=ListItemView.extend({className:"tweet t3d",events:{tap:"itemClicked"},_rgxTweetUserName:new RegExp("\\[twit=(.*?)](.*?)\\[/twit]","g"),_rgxTweetLink:new RegExp("\\[url\\](.*?)\\[/url\\]","g"),_rgxTweetTrend:new RegExp("\\[trend=(.*?)](.*?)\\[/trend]","g"),_updateTextWithStyledLinks:function(e,d){if(!d){d=""}var a=this.options.layoutId;if(a==1){var c="clr_contTypeA_lnkTxt"}else{var c="clr_contTypeB_lnkTxt"}var b='<a href="javascript:void(0)" class="'+c+'" urlSrc="http://twitter.com/$1" class="LinkURL slide"'+d+">$2</a>";e=e.replace(this._rgxTweetUserName,b);b='<a href="javascript:void(0)" class="'+c+'" urlSrc="$1" class="LinkURL slide"'+d+">$1</a>";e=e.replace(this._rgxTweetLink,b);b='<a href="javascript:void(0)" class="'+c+'" urlSrc="http://mobile.twitter.com/searches?q=%23$1" class="LinkURL slide"'+d+">#$1</a>";e=e.replace(this._rgxTweetTrend,b);return e},render:function(){this.model.set({userJSON:this.model.get("user").toJSON()});var b=this.model.toJSON();var a=this.options.layoutId;if(a==1){var c="clr_contTypeA_classicItem_bg clr_contTypeA_classicItem_brdr feed_classic_item";b.colorClassType="A"}else{a=0;var c="clr_contTypeB_bubbleItem_bg clr_contTypeB_bubbleItem_brdr feed_bubble_item";b.colorClassType="B"}this.$el.html(twitterTemplates.tweet_li(b)).attr("data-role","button").addClass(c);this.$el.find("a").bind("tap",this.itemClicked.hitch(this));return this},itemClicked:function(b){b.preventDefault();var c=b.target;var a=c.nodeName=="A";if(a){this.trigger("onLinkPressed",c.innerHTML)}else{UN.navTo(this.model.get("alias"),{level:3,isInner:(LAYOUT===layoutFormat.narrow)})}return false}}); var UserHeaderView=Backbone.View.extend({className:"clr_contTypeB_headerItem_bg clr_contTypeB_headerItem_brdr t3d",events:{"tap .tweet-follow-button":"_followButtonClicked"},render:function(){var c=this.model.toJSON();this.$el.html(twitterTemplates.userHeader(c));this.model.bind("change:isFollowing",this._onIsFollowingChanged,this);var b=this.model.get("isFollowing");if(typeof(b)==="undefined"){var a=this;TwitterManager.isFollowingUser(this.model.get("screenName"),function(d){a.model.set({isFollowing:d})},function(){a.model.set({isFollowing:false})})}return this},_onIsFollowingChanged:function(c,d){var a=this.$el.find(".tweet-follow-button");var b=_T("HtmlTextTwitterFollowButton");if(d){b=_T("HtmlTextTwitterUnfollowButton")}a.text(b)},_followButtonClicked:function(b){b.preventDefault();var a=this.model.get("screenName");TwitterManager.followUser(a);return false}}); var TweetsView=Backbone.View.extend({initialize:function(){this.$el.attr({"data-role":"page","data-buttons":"refresh"});this.model.bind("change:user",this.renderHeader,this);this.model.bind("change:query",this.renderHeader,this);this.$el.bind("refresh",this.handleRefreshClick.hitch(this));this.$el.bind("silentRefresh",this.handleSilentRefresh.hitch(this))},handleRefreshClick:function(){if(this.tweetListView){this.tweetListView.handleRefreshClick()}},handleSilentRefresh:function(){if(this.tweetListView){this.tweetListView.handleSilentRefresh()}},render:function(){var b=document.createElement("div");b.className="scroll_wrapper";this.scrollerElement=document.createElement("div");this.scrollerElement.className="scroller";b.appendChild(this.scrollerElement);this.el.appendChild(b);var d=$(b);Scrolling.init(d);var c=this.model.get("params");if(c){this.tweetListView=new TweetListView({model:this.model,layoutId:this.model.get("params").layoutId,showMoreStr:_T("HtmlTextTwitterShowMoreTweets"),loadingStr:_T("HtmlTextTwitterLoadingTweets")});this.tweetListView.bind("onLinkPressed",this.onLinkPressed,this);var a=this.tweetListView.render().el;this.$header=$('<div class="header_container"></div>');$(this.scrollerElement).append(this.$header).append(a)}return this},renderHeader:function(){var e=this.model.get("type");if(e==TwitterTemplateHelper.TWEET_LIST_TYPE_USER||e==TwitterTemplateHelper.TWEET_LIST_TYPE_LIST){var d=this.model.get("user");if(d){var c=new UserHeaderView({model:d,layoutId:this.model.get("params").layoutId});c.bind("onLinkPressed",this.onLinkPressed,this);var f=c.render().el;this.$header.html(f)}}else{var b=new SearchHeaderView({model:this.model,layoutId:this.model.get("params").layoutId});var a=b.render().el;this.$header.html(a)}return this},onLinkPressed:function(a){this.trigger("onLinkPressed",a)},addTabsView:function(a){$(this.scrollerElement).prepend(a)}}); 